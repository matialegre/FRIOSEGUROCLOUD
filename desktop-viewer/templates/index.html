<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>FrioSeguro</title>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Segoe UI,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh}.navbar{background:#1e293b;padding:15px 30px;display:flex;justify-content:space-between;border-bottom:1px solid #334155}.navbar h1{color:#3b82f6;font-size:1.5rem}.container{padding:20px 30px}.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:20px}.stat-card{background:#1e293b;border-radius:10px;padding:20px;text-align:center;border:1px solid #334155}.stat-value{font-size:2.5rem;font-weight:bold}.stat-label{color:#94a3b8;font-size:.8rem;text-transform:uppercase}.text-blue{color:#3b82f6}.text-green{color:#22c55e}.text-yellow{color:#eab308}.text-red{color:#ef4444}.export-box{background:linear-gradient(135deg,#1e3a5f,#0f172a);border:2px dashed #3b82f6;border-radius:12px;padding:25px;margin-bottom:20px}.export-box h3{margin-bottom:15px;color:#3b82f6}.filters{display:flex;gap:15px;flex-wrap:wrap;margin-bottom:20px}.filter-group{display:flex;flex-direction:column;gap:5px}.filter-group label{font-size:.75rem;color:#94a3b8;text-transform:uppercase}select,input[type=date]{background:#334155;border:1px solid #475569;color:#e2e8f0;padding:10px 15px;border-radius:6px;font-size:.9rem;min-width:150px}.btn{padding:12px 25px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;font-size:1rem}.btn-primary{background:#3b82f6;color:#fff}.btn-excel{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;font-size:1.1rem;padding:15px 35px}.btn-pdf{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;font-size:1.1rem;padding:15px 35px}.export-buttons{display:flex;gap:20px;justify-content:center;margin-top:20px;padding-top:20px;border-top:1px solid #334155}.card{background:#1e293b;border-radius:10px;border:1px solid #334155;overflow:hidden}.card-header{background:#334155;padding:15px 20px;font-weight:bold;display:flex;justify-content:space-between}.table-container{max-height:450px;overflow-y:auto}table{width:100%;border-collapse:collapse}th{background:#334155;padding:12px 10px;text-align:left;font-size:.7rem;text-transform:uppercase;position:sticky;top:0}td{padding:10px;border-bottom:1px solid #334155;font-size:.85rem}tr:hover{background:rgba(59,130,246,.1)}.badge{padding:4px 10px;border-radius:4px;font-size:.7rem;font-weight:bold}.badge-green{background:#22c55e;color:#fff}.badge-red{background:#ef4444;color:#fff}.badge-orange{background:#f97316;color:#fff}.badge-gray{background:#475569;color:#94a3b8}.badge-blue{background:#3b82f6;color:#fff}code{background:#334155;padding:2px 6px;border-radius:4px;font-size:.8rem}</style>
</head><body>
<nav class="navbar"><h1>FrioSeguro Desktop</h1><span id="lastUpdate" style="color:#94a3b8">Actualizado: --:--:--</span></nav>
<div class="container">
<div class="stats"><div class="stat-card"><div class="stat-value text-blue" id="statDevices">-</div><div class="stat-label">Dispositivos</div></div><div class="stat-card"><div class="stat-value text-green" id="statOnline">-</div><div class="stat-label">Online</div></div><div class="stat-card"><div class="stat-value text-yellow" id="statReadings">-</div><div class="stat-label">Lecturas</div></div><div class="stat-card"><div class="stat-value text-red" id="statAlerts">-</div><div class="stat-label">Alertas</div></div></div>
<div class="export-box"><h3>EXPORTAR DATOS</h3>
<div class="filters"><div class="filter-group"><label>Dispositivo</label><select id="filterDevice"><option value="">Todos</option></select></div><div class="filter-group"><label>Fecha Desde</label><input type="date" id="filterDateFrom"></div><div class="filter-group"><label>Fecha Hasta</label><input type="date" id="filterDateTo"></div><div class="filter-group"><label>Limite</label><select id="filterLimit"><option value="100">100</option><option value="500">500</option><option value="1000" selected>1000</option><option value="5000">5000</option></select></div><div class="filter-group"><label>&nbsp;</label><button class="btn btn-primary" onclick="loadReadings()">FILTRAR</button></div></div>
<div class="export-buttons"><button class="btn btn-excel" onclick="exportExcel()">DESCARGAR EXCEL</button><button class="btn btn-pdf" onclick="exportExcel()">DESCARGAR PDF</button></div></div>
<div class="card"><div class="card-header"><span>Lecturas de Temperatura</span><span id="readingsCount" style="color:#94a3b8">0 registros</span></div><div class="table-container"><table><thead><tr><th>Fecha/Hora</th><th>Dispositivo</th><th>Temp</th><th>T1</th><th>T2</th><th>Hum</th><th>Puerta</th><th>Sirena</th><th>Alerta</th><th>Defrost</th></tr></thead><tbody id="readingsTable"><tr><td colspan="10" style="text-align:center;padding:30px">Cargando...</td></tr></tbody></table></div></div>
</div>
<script>
var devices=[],currentReadings=[];
function formatDate(d){if(!d)return'-';return new Date(d).toLocaleString('es-AR')}
function loadStats(){fetch('/api/stats').then(function(r){return r.json()}).then(function(d){document.getElementById('statDevices').textContent=d.total_devices;document.getElementById('statOnline').textContent=d.online_devices;document.getElementById('statReadings').textContent=d.total_readings;document.getElementById('statAlerts').textContent=d.active_alerts}).catch(function(e){console.error(e)})}
function loadDevices(){fetch('/api/devices').then(function(r){return r.json()}).then(function(data){devices=data;var opts='<option value="">Todos</option>';devices.forEach(function(d){opts+='<option value="'+d.device_id+'">'+(d.name||d.device_id)+'</option>'});document.getElementById('filterDevice').innerHTML=opts}).catch(function(e){console.error(e)})}
function getParams(){var p=new URLSearchParams();var dev=document.getElementById('filterDevice').value;var from=document.getElementById('filterDateFrom').value;var to=document.getElementById('filterDateTo').value;var lim=document.getElementById('filterLimit').value;if(dev)p.append('device_id',dev);if(from)p.append('date_from',from);if(to)p.append('date_to',to);p.append('limit',lim);return p.toString()}
function loadReadings(){fetch('/api/readings?'+getParams()).then(function(r){return r.json()}).then(function(data){currentReadings=data;var html='';if(data.length===0){html='<tr><td colspan="10" style="text-align:center;padding:30px;color:#f97316">No hay datos</td></tr>'}else{data.forEach(function(r){html+='<tr><td>'+formatDate(r.created_at)+'</td><td><code>'+r.device_id+'</code></td><td>'+(r.temp_avg!=null?r.temp_avg.toFixed(1):'-')+'C</td><td>'+(r.temp1!=null?r.temp1.toFixed(1):'-')+'C</td><td>'+(r.temp2!=null?r.temp2.toFixed(1):'-')+'C</td><td>'+(r.humidity!=null?r.humidity.toFixed(0):'-')+'%</td><td><span class="badge '+(r.door1_open?'badge-orange':'badge-gray')+'">'+(r.door1_open?'ABIERTA':'Cerrada')+'</span></td><td><span class="badge '+(r.relay_on?'badge-red':'badge-gray')+'">'+(r.relay_on?'ON':'OFF')+'</span></td><td><span class="badge '+(r.alert_active?'badge-red':'badge-gray')+'">'+(r.alert_active?'ACTIVA':'OK')+'</span></td><td><span class="badge '+(r.defrost_mode?'badge-blue':'badge-gray')+'">'+(r.defrost_mode?'ACTIVO':'No')+'</span></td></tr>'})}document.getElementById('readingsTable').innerHTML=html;document.getElementById('readingsCount').textContent=data.length+' registros';document.getElementById('lastUpdate').textContent='Actualizado: '+new Date().toLocaleTimeString('es-AR')}).catch(function(e){console.error(e)})}
function exportExcel(){window.location.href='/api/export/excel?'+getParams()}
var today=new Date().toISOString().slice(0,10);document.getElementById('filterDateTo').value=today;
loadStats();loadDevices();loadReadings();
setInterval(function(){loadStats();loadReadings()},30000);
</script>
</body></html>
